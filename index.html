<!DOCTYPE html>
<html lang="en" data-theme="light">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Aafaq Sabir ‚Äî PhD Student, NC State</title>
  <meta name="description"
    content="Aafaq Sabir is a PhD Computer Science student at North Carolina State University, researching security and privacy in smart home devices and voice assistants.">
  <meta name="author" content="Aafaq Sabir">
  <meta name="keywords"
    content="Aafaq Sabir, NC State, Computer Science, Security, Privacy, Voice Assistants, Smart Home, PhD">
  <link rel="shortcut icon" href="images/favicon.ico">
  <link rel="stylesheet" href="style.css?v=2">
</head>

<body>

  <!-- ========== Navigation ========== -->
  <nav class="site-nav">
    <div class="nav-inner">
      <button class="mobile-menu-toggle" aria-label="Toggle menu"
        onclick="document.querySelector('.nav-links').classList.toggle('open')">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
          stroke-linecap="round">
          <line x1="3" y1="6" x2="21" y2="6" />
          <line x1="3" y1="12" x2="21" y2="12" />
          <line x1="3" y1="18" x2="21" y2="18" />
        </svg>
      </button>
      <ul class="nav-links">
        <li><a href="#about" class="active">About</a></li>
        <li><a href="#news">News</a></li>
        <li><a href="#research">Research</a></li>
        <li><a href="#publications">Publications</a></li>
        <li><a href="#experience">Experience</a></li>
        <li><a href="#more">More</a></li>
        <li><a href="#contact">Contact</a></li>
      </ul>
      <button class="theme-toggle" aria-label="Toggle dark mode" onclick="toggleTheme()">
        <span id="theme-icon">üí°</span>
      </button>
    </div>
  </nav>

  <!-- ========== Main Content ========== -->
  <main class="container">

    <!-- Hero (populated by JS) -->
    <header class="hero" id="about">
      <div class="hero-content">
        <div class="hero-text">
          <h1 class="hero-name" id="hero-name"></h1>
          <p class="hero-subtitle" id="hero-subtitle"></p>
        </div>
        <img id="hero-photo" class="hero-photo" alt="Profile photo" style="display:none">
      </div>
    </header>

    <!-- Info Table (populated by JS) -->
    <table class="info-table" id="info-table"></table>

    <!-- Bio -->
    <div class="bio" id="bio"></div>

    <!-- CV Download -->
    <div class="cv-download" id="cv-download"></div>

    <!-- ========== News ========== -->
    <section class="section" id="news">
      <h2 class="section-title">Latest News <a href="#news" class="anchor">#</a></h2>
      <hr class="section-divider">
      <ul class="news-list" id="news-list"></ul>
    </section>

    <!-- ========== Education ========== -->
    <section class="section" id="education">
      <h2 class="section-title">Education <a href="#education" class="anchor">#</a></h2>
      <hr class="section-divider">
      <div id="edu-list"></div>
    </section>

    <!-- ========== Research ========== -->
    <section class="section" id="research">
      <h2 class="section-title">My Research <a href="#research" class="anchor">#</a></h2>
      <hr class="section-divider">
      <p class="research-intro" id="research-intro"></p>
      <table class="interest-table" id="interest-table"></table>
    </section>

    <!-- ========== Publications ========== -->
    <section class="section" id="publications">
      <h2 class="section-title">Publications <a href="#publications" class="anchor">#</a></h2>
      <hr class="section-divider">
      <p class="pub-intro">Selected publications highlighting my research. My name is shown in <strong>bold</strong>.
      </p>
      <div id="pub-list"></div>
    </section>

    <!-- ========== Posters ========== -->
    <section class="section" id="posters">
      <h2 class="section-title">Poster Presentations <a href="#posters" class="anchor">#</a></h2>
      <hr class="section-divider">
      <ul class="poster-list" id="poster-list"></ul>
    </section>

    <!-- ========== Experience ========== -->
    <section class="section" id="experience">
      <h2 class="section-title">Experience <a href="#experience" class="anchor">#</a></h2>
      <hr class="section-divider">
      <ul class="exp-list" id="exp-list"></ul>
    </section>

    <!-- ========== Teaching ========== -->
    <section class="section" id="teaching">
      <h2 class="section-title">Teaching <a href="#teaching" class="anchor">#</a></h2>
      <hr class="section-divider">
      <ul class="teaching-list" id="teaching-list"></ul>
    </section>

    <!-- ========== Awards, Fellowships & Service ========== -->
    <section class="section" id="more">
      <h2 class="section-title">Awards & Fellowships <a href="#more" class="anchor">#</a></h2>
      <hr class="section-divider">
      <div id="awards-list"></div>

      <h3 class="subsection-title">Fellowships</h3>
      <ul class="fellowship-list" id="fellowship-list"></ul>

      <h3 class="subsection-title">Service & Peer Reviewing</h3>
      <ul class="service-list" id="service-list"></ul>

      <h3 class="subsection-title">Mentoring & Outreach</h3>
      <ul class="mentoring-list" id="mentoring-list"></ul>
    </section>

    <!-- ========== Skills ========== -->
    <section class="section" id="skills">
      <h2 class="section-title">Skills <a href="#skills" class="anchor">#</a></h2>
      <hr class="section-divider">
      <div id="skills-content"></div>
    </section>

    <!-- ========== Contact ========== -->
    <section class="section" id="contact">
      <h2 class="section-title">Contact <a href="#contact" class="anchor">#</a></h2>
      <hr class="section-divider">
      <div id="contact-content"></div>
    </section>

  </main>

  <!-- ========== Footer ========== -->
  <footer class="site-footer">
    <div class="footer-inner" id="footer-inner"></div>
  </footer>

  <!-- ========== Citation Modal ========== -->
  <div id="cite-modal" class="cite-overlay" style="display:none" onclick="if(event.target===this)closeCiteModal()">
    <div class="cite-dialog">
      <div class="cite-header">
        <span class="cite-title">BibTeX Citation</span>
        <button class="cite-close" onclick="closeCiteModal()" aria-label="Close">&times;</button>
      </div>
      <pre class="cite-code" id="cite-code"></pre>
      <button class="cite-copy" id="cite-copy" onclick="copyCitation()">Copy to Clipboard</button>
    </div>
  </div>

  <!-- ========== SVG Icon Templates ========== -->
  <template id="icon-pdf">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
      <polyline points="14 2 14 8 20 8" />
    </svg>
  </template>
  <template id="icon-code">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
      stroke-linejoin="round">
      <polyline points="16 18 22 12 16 6" />
      <polyline points="8 6 2 12 8 18" />
    </svg>
  </template>
  <template id="icon-cite">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
      stroke-linejoin="round">
      <path
        d="M3 21c3 0 7-1 7-8V5c0-1.25-.756-2.017-2-2H4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2 1 0 1 0 1 1v1c0 1-1 2-2 2s-1 .008-1 1.031V21z" />
      <path
        d="M15 21c3 0 7-1 7-8V5c0-1.25-.757-2.017-2-2h-4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2h.75c0 2.25.25 4-2.75 4v3z" />
    </svg>
  </template>
  <template id="icon-slides">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
      stroke-linejoin="round">
      <rect x="2" y="3" width="20" height="14" rx="2" />
      <line x1="8" y1="21" x2="16" y2="21" />
      <line x1="12" y1="17" x2="12" y2="21" />
    </svg>
  </template>
  <template id="icon-video">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
      stroke-linejoin="round">
      <polygon points="23 7 16 12 23 17 23 7" />
      <rect x="1" y="5" width="15" height="14" rx="2" />
    </svg>
  </template>
  <template id="icon-link">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
      stroke-linejoin="round">
      <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" />
      <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" />
    </svg>
  </template>

  <!-- ========== Scripts ========== -->
  <script>
    /* ---- SVG icon helper ---- */
    const ICON_TEMPLATES = {};
    document.querySelectorAll('template[id^="icon-"]').forEach(t => {
      ICON_TEMPLATES[t.id.replace('icon-', '')] = t.content.firstElementChild.outerHTML;
    });

    /* ---- Nice display labels for link types ---- */
    const LINK_LABELS = {
      pdf: 'PDF',
      code: 'Code',
      cite: 'Cite',
      slides: 'Slides',
      video: 'Video',
      link: 'Link'
    };

    /* ---- Render functions ---- */

    function renderProfile(p) {
      // Email display (no mailto ‚Äî anti-scraping)
      const emailDisplay = `${p.email.user} at ${p.email.domain} dot ${p.email.tld}`;

      // Hero
      document.getElementById('hero-name').innerHTML =
        `<span class="first-name">${p.firstName}</span> <span class="last-name">${p.lastName}</span>`;
      document.getElementById('hero-subtitle').innerHTML =
        `${p.title} at <a href="${p.institutionUrl}" class="badge" target="_blank" rel="noopener">${p.institution}</a>`;

      // Profile photo
      if (p.profileImage) {
        const img = document.getElementById('hero-photo');
        img.src = p.profileImage;
        img.alt = `${p.firstName} ${p.lastName}`;
        img.style.display = '';
      }

      // Info table
      const rows = [
        `<tr><td>Affiliation:</td><td><a href="${p.affiliation.url}" target="_blank" rel="noopener">${p.affiliation.name}</a></td></tr>`,
        `<tr><td>Email:</td><td>
        <svg class="info-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="4" width="20" height="16" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/></svg>
        ${emailDisplay}</td></tr>`,
        `<tr><td>Academic:</td><td>
        <a href="${p.scholar}" target="_blank" rel="noopener">
          <svg class="info-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M5.242 13.769L0 9.5L12 0l12 9.5l-5.242 4.269C17.548 11.249 14.978 9.5 12 9.5c-2.977 0-5.548 1.748-6.758 4.269zM12 10a7 7 0 1 0 0 14 7 7 0 0 0 0-14z"/></svg>
          Google Scholar
        </a></td></tr>`,
        `<tr><td>Other:</td><td>
        <a href="${p.github}" target="_blank" rel="noopener">
          <svg class="info-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0 0 24 12c0-6.63-5.37-12-12-12z"/></svg>
          GitHub
        </a>
        <span class="separator">¬∑</span>
        <a href="${p.linkedin}" target="_blank" rel="noopener">
          <svg class="info-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 0 1-2.063-2.065 2.064 2.064 0 1 1 2.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
          LinkedIn
        </a>
        <span class="separator">¬∑</span>
        <a href="${p.twitter}" target="_blank" rel="noopener">ùïè Twitter</a>
      </td></tr>`
      ];
      document.getElementById('info-table').innerHTML = rows.join('');

      // Bio
      document.getElementById('bio').innerHTML = `<p>${p.bio}</p>`;

      // CV download button
      if (p.cvLink) {
        document.getElementById('cv-download').innerHTML = `
        <a href="${p.cvLink}" class="cv-btn" target="_blank" rel="noopener">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="16" height="16"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
          Download CV
        </a>`;
      }

      // Footer
      document.getElementById('footer-inner').innerHTML = `
      <ul class="footer-links">
        <li><a href="${p.scholar}" target="_blank" rel="noopener">Google Scholar</a></li>
        <li><a href="${p.github}" target="_blank" rel="noopener">GitHub</a></li>
        <li><a href="${p.linkedin}" target="_blank" rel="noopener">LinkedIn</a></li>
        <li><a href="${p.twitter}" target="_blank" rel="noopener">Twitter</a></li>
      </ul>
      <p class="footer-copy">&copy; ${new Date().getFullYear()} ${p.firstName} ${p.lastName}</p>`;
    }

    function renderNews(news) {
      const list = document.getElementById('news-list');
      list.innerHTML = news.map(item => `
      <li class="news-item">
        <span class="news-icon">${item.icon}</span>
        <div class="news-body">
          <span class="news-date">${item.date}</span>
          <span class="news-text">${item.text}</span>
        </div>
      </li>`).join('');
    }

    function renderResearch(r) {
      document.getElementById('research-intro').innerHTML = r.description;

      const rows = r.interests.map((item, i) => `
      <tr>
        <td>${i === 0 ? 'Interests:' : ''}</td>
        <td><strong>${item.title}.</strong> ${item.detail}</td>
      </tr>`).join('');
      document.getElementById('interest-table').innerHTML = rows;
    }

    function renderPublications(pubs) {
      const container = document.getElementById('pub-list');
      let html = '';
      let currentYear = null;

      pubs.forEach(pub => {
        // Year header
        if (pub.year !== currentYear) {
          currentYear = pub.year;
          html += `<div class="pub-year">${currentYear}</div>`;
        }

        // Action buttons ‚Äî renders whatever keys are in the links object
        let buttons = '';
        if (pub.links) {
          for (const [type, url] of Object.entries(pub.links)) {
            const icon = ICON_TEMPLATES[type] || ICON_TEMPLATES['link'] || '';
            const label = LINK_LABELS[type] || type.charAt(0).toUpperCase() + type.slice(1);
            buttons += `<a href="${url}" class="pub-btn" target="_blank" rel="noopener">${icon} ${label}</a>`;
          }
        }
        // Cite button (auto-added if bibtex exists)
        if (pub.bibtex) {
          const citeIcon = ICON_TEMPLATES['cite'] || '';
          buttons += `<button class="pub-btn cite-btn" onclick="openCiteModal(this)" data-bibtex="${pub.bibtex.replace(/"/g, '&quot;')}">${citeIcon} Cite</button>`;
        }

        const awardBadge = pub.award ? `<span class="pub-award">üèÜ ${pub.award}</span>` : '';

        html += `
        <div class="pub-entry">
          <div class="pub-label"><span>${pub.id}</span></div>
          <div class="pub-content">
            <div class="pub-title">
              <a href="${pub.url}" target="_blank" rel="noopener">${pub.title}</a>
              ${awardBadge}
            </div>
            <div class="pub-authors">${pub.authors}</div>
            <div class="pub-venue">
              <span class="venue-name">${pub.venueShort}.</span> <em>${pub.venueFull}</em>${pub.venueExtra ? ', ' + pub.venueExtra : ''}.
            </div>
            <div class="pub-actions">${buttons}</div>
          </div>
        </div>`;
      });

      container.innerHTML = html;
    }

    function renderPosters(posters) {
      const list = document.getElementById('poster-list');
      list.innerHTML = posters.map(p => `
      <li class="poster-item">
        <div class="poster-title">${p.title}</div>
        <div class="poster-authors">${p.authors}</div>
        <div class="poster-venue">${p.venue}</div>
      </li>`).join('');
    }

    function renderExperience(exps) {
      const list = document.getElementById('exp-list');
      list.innerHTML = exps.map(e => `
      <li class="exp-item">
        <div class="exp-header">
          <span class="exp-org">${e.org}</span>
          <span class="exp-date">${e.date}</span>
        </div>
        <div class="exp-role">${e.role}</div>
        ${e.detail ? `<div class="exp-detail">${e.detail}</div>` : ''}
      </li>`).join('');
    }

    function renderEducation(edu) {
      const el = document.getElementById('edu-list');
      el.innerHTML = edu.map(e => `
      <div class="edu-card">
        <div class="edu-header">
          <span class="edu-degree">${e.degree}</span>
          <span class="edu-date">${e.date}</span>
        </div>
        <div class="edu-institution"><a href="${e.url}" target="_blank" rel="noopener">${e.institution}</a></div>
        <div class="edu-meta">
          <span class="edu-gpa">CGPA: ${e.gpa}</span>
          ${e.advisor ? `<span class="edu-advisor">Advisor: ${e.advisor}</span>` : ''}
        </div>
        ${e.details && e.details.length ? `<ul class="edu-details">${e.details.map(d => `<li>${d}</li>`).join('')}</ul>` : ''}
      </div>`).join('');
    }

    function renderTeaching(items) {
      const list = document.getElementById('teaching-list');
      list.innerHTML = items.map(t => `
      <li class="teaching-item">
        <div class="teaching-header">
          <span class="teaching-role">${t.role}</span>
          <span class="teaching-date">${t.date}</span>
        </div>
        <div class="teaching-course">${t.course} ‚Äî ${t.institution}</div>
        ${t.detail ? `<div class="teaching-detail">${t.detail}</div>` : ''}
      </li>`).join('');
    }

    function renderAwards(awards) {
      const el = document.getElementById('awards-list');
      el.innerHTML = `<ul class="awards-grid">${awards.map(a => `
      <li class="award-item">
        <span class="award-icon">${a.icon}</span>
        <div class="award-body">
          <span class="award-title">${a.title}</span>
          <span class="award-detail">${a.detail}</span>
        </div>
      </li>`).join('')}</ul>`;
    }

    function renderFellowships(items) {
      const list = document.getElementById('fellowship-list');
      list.innerHTML = items.map(f => `
      <li class="fellowship-item">
        <div class="fellowship-header">
          <span class="fellowship-title">${f.title}</span>
          <span class="fellowship-date">${f.date}</span>
        </div>
        ${f.detail ? `<div class="fellowship-detail">${f.detail}</div>` : ''}
      </li>`).join('');
    }

    function renderService(items) {
      const list = document.getElementById('service-list');
      list.innerHTML = items.map(s => `
      <li class="service-item">
        <span class="service-role">${s.role}</span>
        <span class="service-venue">${s.venue}</span>
      </li>`).join('');
    }

    function renderMentoring(items) {
      const list = document.getElementById('mentoring-list');
      list.innerHTML = items.map(m => `
      <li class="mentoring-item">
        <div class="mentoring-header">
          <span class="mentoring-program">${m.program}</span>
          <span class="mentoring-year">${m.year}</span>
        </div>
        <div class="mentoring-mentees">Mentee${m.mentees.includes(',') ? 's' : ''}: ${m.mentees}</div>
      </li>`).join('');
    }

    function renderSkills(skills) {
      const el = document.getElementById('skills-content');
      el.innerHTML = Object.entries(skills).map(([category, items]) => `
      <div class="skill-group">
        <h4 class="skill-category">${category}</h4>
        <div class="skill-pills">
          ${items.map(s => `<span class="skill-pill">${s}</span>`).join('')}
        </div>
      </div>`).join('');
    }

    function renderContact(c) {
      const el = document.getElementById('contact-content');
      const cEmailDisplay = `${c.email.user} at ${c.email.domain} dot ${c.email.tld}`;
      el.innerHTML = `
      <div class="contact-grid">
        <div class="contact-item">
          <span class="contact-label">Email:</span>
          <span class="contact-value">${cEmailDisplay}</span>
        </div>
        <div class="contact-item">
          <span class="contact-label">Phone:</span>
          <span class="contact-value">${c.phone}</span>
        </div>
      </div>
      <div class="mail-address">${c.address.join('<br>')}</div>`;
    }

    /* ---- Load data and render ---- */
    fetch('data.json', { cache: 'no-store' })
      .then(r => r.json())
      .then(data => {
        renderProfile(data.profile);
        renderNews(data.news);
        renderEducation(data.education);
        renderResearch(data.research);
        renderPublications(data.publications);
        renderPosters(data.posters);
        renderExperience(data.experience);
        renderTeaching(data.teaching);
        renderAwards(data.awards);
        renderFellowships(data.fellowships);
        renderService(data.service);
        renderMentoring(data.mentoring);
        renderSkills(data.skills);
        renderContact(data.contact);
      })
      .catch(err => console.error('Failed to load data.json:', err));

    /* ---- Theme toggle ---- */
    function toggleTheme() {
      const html = document.documentElement;
      const current = html.getAttribute('data-theme');
      const next = current === 'dark' ? 'light' : 'dark';
      html.setAttribute('data-theme', next);
      localStorage.setItem('theme', next);
      updateThemeIcon(next);
    }

    function updateThemeIcon(theme) {
      document.getElementById('theme-icon').textContent = theme === 'dark' ? 'üåô' : 'üí°';
    }

    // Restore saved theme
    (function () {
      const saved = localStorage.getItem('theme');
      if (saved) {
        document.documentElement.setAttribute('data-theme', saved);
        updateThemeIcon(saved);
      } else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.documentElement.setAttribute('data-theme', 'dark');
        updateThemeIcon('dark');
      }
    })();

    // Active nav link highlighting on scroll
    (function () {
      const sections = document.querySelectorAll('.section, .hero');
      const navLinks = document.querySelectorAll('.nav-links a');

      function updateActive() {
        let current = '';
        sections.forEach(section => {
          const top = section.offsetTop - 100;
          if (window.scrollY >= top) {
            current = section.getAttribute('id');
          }
        });
        navLinks.forEach(link => {
          link.classList.remove('active');
          if (link.getAttribute('href') === '#' + current) {
            link.classList.add('active');
          }
        });
      }

      window.addEventListener('scroll', updateActive, { passive: true });
      updateActive();
    })();

    // Close mobile menu on link click
    document.querySelectorAll('.nav-links a').forEach(link => {
      link.addEventListener('click', () => {
        document.querySelector('.nav-links').classList.remove('open');
      });
    });

    /* ---- Citation modal ---- */
    function openCiteModal(btn) {
      const bibtex = btn.getAttribute('data-bibtex');
      document.getElementById('cite-code').textContent = bibtex;
      document.getElementById('cite-copy').textContent = 'Copy to Clipboard';
      document.getElementById('cite-modal').style.display = 'flex';
      document.body.style.overflow = 'hidden';
    }

    function closeCiteModal() {
      document.getElementById('cite-modal').style.display = 'none';
      document.body.style.overflow = '';
    }

    function copyCitation() {
      const text = document.getElementById('cite-code').textContent;
      navigator.clipboard.writeText(text).then(() => {
        const btn = document.getElementById('cite-copy');
        btn.textContent = '‚úì Copied!';
        setTimeout(() => { btn.textContent = 'Copy to Clipboard'; }, 2000);
      });
    }

    document.addEventListener('keydown', e => {
      if (e.key === 'Escape') closeCiteModal();
    });
  </script>

</body>

</html>